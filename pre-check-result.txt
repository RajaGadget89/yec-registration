üöÄ Starting Pre-CI/CD Checks...
==================================

[0;34müß∞ Runtime Guard[0m
--------------------------------
[0;32m‚úÖ Node v18.20.8[0m
üß© Loaded env from: .env.local

[0;34müõ°Ô∏è  Change Allowlist (optional)[0m
--------------------------------
Skip allowlist check for now
[0;32m‚úÖ Allowlist skipped[0m

[0;34müîê ENV Sanity[0m
--------------------------------
ENV OK (masked) URL=https://wvwzhpyvogwypmqgvtjv.supabase.co SRK=eyJhbG**** ENV=staging

[0;34müîç Code Quality[0m
--------------------------------
ESLint (no warnings)
‚úî No ESLint warnings or errors
[0;32m‚úÖ ESLint (no warnings)[0m
TypeScript compile (noEmit)
[0;32m‚úÖ TypeScript compile (noEmit)[0m

[0;34müîí Security-Critical Unit Tests[0m
--------------------------------
filenameUtils.test.ts
üß™ Testing Filename Utilities...

üìù Testing sanitizeFilename:
‚úÖ Spaces and mixed case: "My Photo.jpg" -> "my_photo.jpg" (expected: "my_photo.jpg")
‚úÖ Spaces and special characters: "file with spaces and (parentheses).png" -> "file_with_spaces_and_parentheses.png" (expected: "file_with_spaces_and_parentheses.png")
‚úÖ Unsafe characters: "file<>:"|?*\/unsafe.txt" -> "file_unsafe.txt" (expected: "file_unsafe.txt")
‚úÖ Path traversal attempt: "../../../etc/passwd" -> "etc_passwd" (expected: "etc_passwd")
‚úÖ Multiple spaces and trimming: "   multiple   spaces   " -> "multiple_spaces" (expected: "multiple_spaces")
‚úÖ Uppercase conversion: "UPPERCASE_FILE.PNG" -> "uppercase_file.png" (expected: "uppercase_file.png")
‚úÖ Already safe filename: "file_with_underscores.txt" -> "file_with_underscores.txt" (expected: "file_with_underscores.txt")
‚úÖ Empty string: "" -> "" (expected: "")
‚úÖ Long filename truncation: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.txt" -> "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.txt" (expected: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.txt")

üîç Testing validateFilename:
‚úÖ Safe filename: "safe-file.txt" -> true (expected: true)
‚úÖ Filename with spaces: "file with spaces.txt" -> false (expected: false)
‚úÖ Filename with unsafe characters: "file<unsafe>.txt" -> false (expected: false)
‚úÖ Path traversal attempt: "../../../etc/passwd" -> false (expected: false)
‚úÖ Empty filename: "" -> false (expected: false)
‚úÖ Too long filename: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" -> false (expected: false)

üìé Testing ensureFileExtension:
‚úÖ Add extension to file without extension: "file" + ".png" -> "file.png" (expected: "file.png")
‚úÖ File already has different extension: "file.jpg" + ".png" -> "file.jpg" (expected: "file.jpg")
‚úÖ File already has correct extension: "file.png" + ".png" -> "file.png" (expected: "file.png")
‚úÖ Case insensitive extension check: "FILE.PNG" + ".png" -> "FILE.PNG" (expected: "FILE.PNG")

üÜî Testing generateUniqueFilename:
‚úÖ Generated unique filename 1: prefix-1755139078677-187ba2b2-test.jpg
‚úÖ Generated unique filename 2: prefix-1755139078677-44da26ce-test.jpg
‚úÖ Filenames are different: true

üéâ All tests completed!
[0;32m‚úÖ filenameUtils.test.ts[0m

[0;34müèóÔ∏è Build Sanity (CI only)[0m
--------------------------------
Skip build (not CI)
[0;32m‚úÖ Build skipped[0m

[0;34müß™ Audit E2E[0m
--------------------------------
Playwright @audit suite


Running 3 tests using 3 workers




[1A[2K[1/3] [firefox] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[1A[2K[2/3] [webkit] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[1A[2K[3/3] [chromium] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[1A[2K[firefox] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[env] SUPABASE_URL project-ref: wvwzhpyvogwypmqgvtjv

[1A[2K[env] SUPABASE_SERVICE_ROLE_KEY: eyJhbG...

[1A[2K[env] NODE_ENV: undefined

[1A[2K[env] PLAYWRIGHT_TEST: undefined

[1A[2K[webkit] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[env] SUPABASE_URL project-ref: wvwzhpyvogwypmqgvtjv

[1A[2K[env] SUPABASE_SERVICE_ROLE_KEY: eyJhbG...

[1A[2K[env] NODE_ENV: undefined

[1A[2K[env] PLAYWRIGHT_TEST: undefined

[1A[2K[chromium] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[env] SUPABASE_URL project-ref: wvwzhpyvogwypmqgvtjv

[1A[2K[env] SUPABASE_SERVICE_ROLE_KEY: eyJhbG...

[1A[2K[env] NODE_ENV: undefined

[1A[2K[env] PLAYWRIGHT_TEST: undefined

[1A[2K[diag] baseURL=http://localhost:8080 x-request-id=test-1755139082828-qhnhs7

[1A[2K[firefox] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[diag] baseURL=http://localhost:8080 x-request-id=test-1755139082827-07jxuk

[1A[2K[webkit] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[diag] baseURL=http://localhost:8080 x-request-id=test-1755139082827-h6bh0k

[1A[2K[chromium] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[diag] ‚úÖ Audit system connectivity verified

[1A[2K[webkit] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[diag] ‚úÖ Audit system connectivity verified

[1A[2K[firefox] ‚Ä∫ tests/e2e/audit-diag.e2e.spec.ts:8:7 ‚Ä∫ Audit System Diagnostic Gate ‚Ä∫ @audit @diag should verify audit system connectivity
[diag] ‚úÖ Audit system connectivity verified

[1A[2K  3 passed (4.4s)
[0;32m‚úÖ Playwright @audit suite[0m

[0;34müß™ Full Test Suite (Optional)[0m
--------------------------------
Set RUN_FULL=1 to run full test suite
[0;32m‚úÖ Full suite skipped[0m

üéâ All Pre-CI/CD Checks Passed!
==================================
[0;32m‚úÖ Ready for CI/CD deployment[0m
