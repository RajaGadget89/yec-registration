name: Deploy to Vercel

on:
  push:
    branches:
      - main               # ğŸŸ£ Production branch: deploy à¸‚à¸¶à¹‰à¸™ production
      - develop            # ğŸŸ¢ Development branch: à¸£à¸§à¸¡ feature à¸«à¸¥à¸²à¸¢à¸•à¸±à¸§à¸à¹ˆà¸­à¸™ release
      - 'feature/**'       # âœ¨ Feature branches: à¹€à¸Šà¹ˆà¸™ feature/registration-form
      - 'fix/**'           # ğŸ Bugfix branches: à¹€à¸Šà¹ˆà¸™ fix/login-error
      - 'bugfix/**'        # ğŸ›  Alternative bugfix naming
      - 'hotfix/**'        # ğŸ”¥ Critical fixes
      - 'release/**'       # ğŸ“¦ Release branches: à¹€à¸•à¸£à¸µà¸¢à¸¡ merge à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆ main
      - 'experiment/**'    # ğŸ§ª à¸—à¸”à¸¥à¸­à¸‡à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œà¹ƒà¸«à¸¡à¹ˆ
      - 'cli/**'           # ğŸ¤– CI/CD testing
      - 'test/**'          # ğŸ§ª UI à¸«à¸£à¸·à¸­ devtools testing
  pull_request:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout Code
        uses: actions/checkout@v3

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Install Dependencies
        run: npm install

      - name: ğŸ›  Build Project
        run: npm run build

      - name: ğŸš€ Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: ./
          vercel-args: '--prod' # deploy production à¸–à¹‰à¸² push à¹„à¸› main

      # âœ… à¹ƒà¸ªà¹ˆ ENV à¸ˆà¸²à¸ Secrets à¸•à¸­à¸™ build
      # à¸–à¹‰à¸²à¹€à¸›à¹‡à¸™ PR à¸ˆà¸²à¸ fork à¸ˆà¸°à¸‚à¹‰à¸²à¸¡ (GitHub à¹„à¸¡à¹ˆà¸ˆà¹ˆà¸²à¸¢ secrets à¹ƒà¸«à¹‰ fork)
      - name: ğŸ—ï¸ Build Project
        if: ${{ github.event_name == 'push' || !github.event.pull_request.head.repo.fork }}
        run: npm run build
        env:
          NODE_ENV: production
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
